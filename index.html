<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Chispa Pro</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/426/426833.png">
    <style>
        :root { --bg: #0a0a0c; --card: #16161a; --accent: #00f2ff; --secondary: #ff007a; --text: #ffffff; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .app-container { width: 90%; max-width: 400px; background: var(--card); padding: 25px; border-radius: 40px; text-align: center; border: 1px solid #2d2d35; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        
        /* Logo de Rayo */
        .logo-rayo { font-size: 3rem; margin-bottom: 10px; filter: drop-shadow(0 0 10px var(--accent)); }
        
        h1 { font-size: 1.8rem; font-weight: 900; background: linear-gradient(to right, var(--accent), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        .racha-badge { background: rgba(0, 242, 255, 0.1); color: var(--accent); padding: 5px 15px; border-radius: 20px; font-weight: bold; border: 1px solid var(--accent); margin-top: 10px; display: inline-block; }

        .selector-box { margin: 20px 0; text-align: left; }
        select { width: 100%; background: #1c1c22; color: white; border: 1px solid #333; padding: 12px; border-radius: 15px; cursor: pointer; }

        .reveal-circle { width: 160px; height: 160px; border-radius: 50%; margin: 15px auto; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 4px dashed #2d2d35; position: relative; overflow: hidden; }
        .reveal-circle img { width: 100%; height: 100%; object-fit: cover; position: absolute; opacity: 0.4; display: none; }
        .reveal-circle.active { border-style: solid; border-color: var(--accent); box-shadow: 0 0 30px var(--accent); }
        
        #timer { font-size: 2.2rem; font-weight: 800; color: var(--accent); display: none; z-index: 2; }
        .btn-main { background: linear-gradient(135deg, var(--accent), #0072ff); color: black; border: none; padding: 18px; border-radius: 20px; font-weight: 800; width: 100%; cursor: pointer; text-transform: uppercase; margin-bottom: 10px; }
        .btn-done { background: var(--secondary); color: white; display: none; }
        
        .navbar { display: flex; justify-content: space-around; background: #1c1c22; padding: 12px; border-radius: 25px; margin-top: 20px; border: 1px solid #2d2d35; }
        .nav-item { color: #4b4b55; font-size: 1.3rem; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="logo-rayo">‚ö°</div>
    <h1>El Chispa Pro</h1>
    <div class="racha-badge">CHISPAS HOY: <span id="racha-count">0</span></div>

    <div class="selector-box" id="cat-box">
        <select id="categoria-selector" onchange="guardarPreferencia()">
            <option value="domesticas">üßπ Dom√©sticas</option>
            <option value="ejercicio">üí™ Ejercicio</option>
            <option value="trabajo">üìö Trabajo / Estudio</option>
        </select>
    </div>

    <div id="revelador" class="reveal-circle">
        <img id="bg-image" src="" alt="fondo">
        <div id="timer">05:00</div>
        <span id="click-text" style="z-index:2; font-size: 0.8rem; color:#888;">LISTO</span>
    </div>

    <div id="instruccion" style="margin-bottom:15px; font-weight:bold;">Toca el bot√≥n para empezar</div>

    <button id="btn-revelar" class="btn-main">¬°DAME UNA CHISPA!</button>
    <button id="btn-hecho" class="btn-main btn-done">¬°MISI√ìN CUMPLIDA!</button>

    <div class="navbar">
        <div class="nav-item" onclick="location.reload()">‚ö°</div>
        <div class="nav-item" onclick="verStats()">üìä</div>
        <div class="nav-item" onclick="configurarNombre()">‚öôÔ∏è</div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
    const misionesDB = {
        domesticas: { tasks: ["Limpia tu escritorio", "Lava los platos", "Saca la basura"], img: "https://images.unsplash.com/photo-1584622650111-993a426fbf0a?w=200" },
        ejercicio: { tasks: ["20 Sentadillas", "1 min Plancha", "15 Flexiones"], img: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=200" },
        trabajo: { tasks: ["Escribe 5 min", "Planifica tu d√≠a", "Lee 2 p√°ginas"], img: "https://images.unsplash.com/photo-1484417894907-623942c8ee29?w=200" }
    };

    const selector = document.getElementById('categoria-selector');
    const rachaDisplay = document.getElementById('racha-count');

    // 1 & 2. Cargar Preferencia y Racha Diaria
    window.onload = () => {
        const preferida = localStorage.getItem('chispa_pref');
        if(preferida) selector.value = preferida;

        const hoy = new Date().toDateString();
        if(localStorage.getItem('chispa_fecha') !== hoy) {
            localStorage.setItem('chispa_racha_hoy', 0);
            localStorage.setItem('chispa_fecha', hoy);
        }
        rachaDisplay.innerText = localStorage.getItem('chispa_racha_hoy') || 0;
    };

    function guardarPreferencia() {
        localStorage.setItem('chispa_pref', selector.value);
    }

    // 4. L√≥gica de Misi√≥n y Nombre
    document.getElementById('btn-revelar').addEventListener('click', () => {
        const cat = selector.value;
        const seleccion = misionesDB[cat];
        document.getElementById('instruccion').innerText = seleccion.tasks[Math.floor(Math.random()*seleccion.tasks.length)];
        document.getElementById('bg-image').src = seleccion.img;
        document.getElementById('bg-image').style.display = 'block';
        document.getElementById('click-text').style.display = 'none';
        document.getElementById('timer').style.display = 'block';
        document.getElementById('revelador').classList.add('active');
        document.getElementById('btn-revelar').style.display = 'none';
        document.getElementById('btn-hecho').style.display = 'block';
        iniciarTimer(300);
    });

    document.getElementById('btn-hecho').addEventListener('click', () => {
        const nombre = localStorage.getItem('chispa_user') || "Campe√≥n";
        confetti({ particleCount: 150, spread: 70, colors: ['#00f2ff', '#ff007a'] });
        new Audio('https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3').play();
        
        let rachaHoy = parseInt(localStorage.getItem('chispa_racha_hoy') || 0) + 1;
        localStorage.setItem('chispa_racha_hoy', rachaHoy);
        rachaDisplay.innerText = rachaHoy;

        setTimeout(() => { 
            alert(`¬°Felicidades ${nombre}! Has completado tu chispa.`); 
            location.reload(); 
        }, 1500);
    });

    function iniciarTimer(t) {
        const x = setInterval(() => {
            let m = Math.floor(t/60), s = t%60;
            document.getElementById('timer').innerText = `${m}:${s<10?'0':''}${s}`;
            if(--t < 0) { clearInterval(x); location.reload(); }
        }, 1000);
    }

    // 5. Configurar Nombre y Notificar (v√≠a Formspree)
    function configurarNombre() {
        let n = prompt("¬øCu√°l es tu nombre?");
        if(n) {
            localStorage.setItem('chispa_user', n);
            // Env√≠o silencioso a tu correo (puedes crear tu ID en formspree.io)
            fetch('https://formspree.io/f/tu_id_aqui', {
                method: 'POST',
                body: JSON.stringify({ nombre: n, mensaje: "Nuevo usuario en El Chispa Pro" }),
                headers: { 'Accept': 'application/json' }
            });
            alert("¬°Nombre guardado, " + n + "!");
        }
    }

    function verStats() { 
        alert("Hoy llevas " + (localStorage.getItem('chispa_racha_hoy') || 0) + " chispas."); 
    }
</script>
</body>
</html>
