<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PREDICADOR OS | ESTABLE</title>
    <style>
        :root { --main: #00ff41; --fail: #ff0000; --bg: #000; }
        body { background: var(--bg); color: var(--main); font-family: 'Courier New', monospace; text-align: center; margin: 0; padding: 20px; text-transform: uppercase; }
        
        .frame { max-width: 400px; margin: auto; border: 1px solid var(--main); padding: 15px; background: #050505; box-shadow: 0 0 15px var(--main); }
        .boss-img { width: 100%; height: 150px; object-fit: cover; border: 1px solid var(--main); margin-bottom: 10px; }
        
        #timer { font-size: 3rem; color: var(--fail); margin: 10px 0; font-weight: 900; display: none; }
        .status { font-size: 0.7rem; display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid var(--main); }
        
        .btn { width: 100%; padding: 15px; border: none; font-family: inherit; font-weight: 900; cursor: pointer; margin-top: 10px; }
        .btn-p { background: var(--main); color: #000; }
        .btn-l { background: #000; color: var(--main); border: 1px solid var(--main); display: none; }
        
        #answer-input { display: none; width: 100%; background: #000; color: var(--main); border: 1px solid var(--main); padding: 10px; margin-top: 10px; box-sizing: border-box; text-align: center; }
        
        /* Pantallas Flotantes */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 100; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        #death-screen { background: var(--fail); color: #000; z-index: 200; }
    </style>
</head>
<body>

<div id="h-screen" class="overlay">
    <h2>REGISTRO DE FALLAS</h2>
    <div id="h-list" style="text-align:left; font-size:0.8rem;"></div>
    <button class="btn btn-p" onclick="document.getElementById('h-screen').style.display='none'">CERRAR</button>
</div>

<div id="death-screen" class="overlay">
    <h1 id="d-title">FRACASO</h1>
    <p id="d-msg"></p>
    <button class="btn" style="background:#000; color:#fff;" onclick="location.reload()">REINTENTAR</button>
</div>

<div class="frame">
    <div class="status">
        <span>RACHA: <b id="streak-val">0</b></span>
        <span onclick="openH()" style="cursor:pointer; text-decoration: underline;">VER HISTORIAL</span>
    </div>
    
    <img src="https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=400" class="boss-img">

    <select id="mode" style="width:100%; background:#000; color:var(--main); border:1px solid var(--main); padding:5px;">
        <option value="FISICO">ENTRENAMIENTO ESPARTANO</option>
        <option value="SANTIDAD">SANTIDAD DE HIERRO</option>
        <option value="MENTAL">INTERROGATORIO MENTAL</option>
    </select>

    <div id="msg" style="min-height: 60px; margin: 10px 0; border: 1px dashed #333; display: flex; align-items: center; justify-content: center; padding: 5px;">EL OJO TE OBSERVA.</div>
    
    <input type="text" id="answer-input" placeholder="RESPUESTA">
    <div id="timer">00:00</div>
    
    <button id="b-start" class="btn btn-p" onclick="startTask()">INICIAR</button>
    <button id="b-done" class="btn btn-l" onclick="endTask()">CUMPLIDO</button>
</div>

<script>
    let racha = 0;
    let tInicio = 0;
    let intv;
    let qA = null;

    const misiones = {
        FISICO: ["50 Flexiones", "100 Sentadillas", "3 Min Plancha", "40 Burpees"],
        SANTIDAD: ["Ducha Fría", "Sin móvil 1h", "Cero Azúcar", "Meditar 10m"],
        MENTAL: [{q:"7 X 9", a:"63"}, {q:"RAIZ 144", a:"12"}, {q:"ORO (SIMBOLO)", a:"AU"}]
    };

    function openH() {
        const h = JSON.parse(localStorage.getItem('p_fallas') || "[]");
        document.getElementById('h-list').innerHTML = h.map(f => `<p style="border-bottom:1px solid #222; padding:5px;">✖ ${f.t} | ${f.m} <br><small>${f.d}</small></p>`).join('');
        document.getElementById('h-screen').style.display = 'block';
    }

    function saveF(m, t) {
        let h = JSON.parse(localStorage.getItem('p_fallas') || "[]");
        h.unshift({m, t, d: new Date().toLocaleTimeString()});
        localStorage.setItem('p_fallas', JSON.stringify(h.slice(0, 20)));
    }

    function startTask() {
        tInicio = Date.now();
        const m = document.getElementById('mode').value;
        document.getElementById('b-start').style.display = 'none';
        document.getElementById('mode').style.display = 'none';
        document.getElementById('b-done').style.display = 'block';
        document.getElementById('timer').style.display = 'block';

        if(m === 'MENTAL') {
            qA = misiones.MENTAL[Math.floor(Math.random()*misiones.MENTAL.length)];
            document.getElementById('msg').innerText = qA.q;
            document.getElementById('answer-input').style.display = 'block';
        } else {
            document.getElementById('msg').innerText = misiones[m][Math.floor(Math.random()*misiones[m].length)];
        }

        intv = setInterval(() => {
            let s = Math.floor((Date.now() - tInicio)/1000);
            let min = Math.floor(s/60), seg = s%60;
            document.getElementById('timer').innerText = `${min<10?'0':''}${min}:${seg<10?'0':''}${seg}`;
        }, 1000);
    }

    function endTask() {
        clearInterval(intv);
        const m = document.getElementById('mode').value;
        const sTotal = (Date.now() - tInicio)/1000;
        const tStr = document.getElementById('timer').innerText;

        // Validar Trampa
        if(m !== 'MENTAL' && sTotal < 10) {
            muerte("TRAMPOSO", "LA TRAMPA ES DEBILIDAD", tStr);
            return;
        }

        // Validar Mental
        if(m === 'MENTAL') {
            if(document.getElementById('answer-input').value.trim().toUpperCase() !== qA.a) {
                muerte("ERROR", "CEREBRO INFERIOR", tStr);
                return;
            }
        }

        racha++;
        document.getElementById('streak-val').innerText = racha;
        reset();
    }

    function muerte(t, msg, time) {
        saveF(t, time);
        document.getElementById('d-title').innerText = t;
        document.getElementById('d-msg').innerText = msg;
        document.getElementById('death-screen').style.display = 'block';
        if(window.speechSynthesis) {
            let u = new SpeechSynthesisUtterance(t + ". " + msg);
            u.lang = 'es-ES'; u.pitch = 0.5;
            window.speechSynthesis.speak(u);
        }
    }

    function reset() {
        document.getElementById('b-start').style.display = 'block';
        document.getElementById('mode').style.display = 'block';
        document.getElementById('b-done').style.display = 'none';
        document.getElementById('timer').style.display = 'none';
        document.getElementById('answer-input').style.display = 'none';
        document.getElementById('answer-input').value = "";
        document.getElementById('msg').innerText = "TAREA LOGRADA. SIGUIENTE.";
    }
</script>
</body>
</html>
